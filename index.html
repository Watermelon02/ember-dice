<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>骰子概率计算器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .transition-custom {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- 左侧控制面板 -->
            <div class="lg:col-span-1 space-y-6">
                <!-- 姿态选择卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow transition-custom hover:shadow-lg">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center">
                        <i class="fa fa-shield mr-2 text-primary"></i>姿态选择
                    </h2>
                    <div class="space-y-4">
                        <div class="form-group flex items-start">
                            <div class="mr-4 mt-1">
                                <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                                    <img src="res/icon_attack.png" alt="攻击姿态图标"
                                        class="w-full h-full object-cover rounded-full">
                                </div>
                            </div>
                            <div class="flex-1">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="attack-stance"
                                        class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary"
                                        checked>
                                    <span class="font-medium text-gray-700">攻击姿态</span>
                                </label>
                                <p class="text-sm text-gray-500 ml-7 mt-1">所有的空心轻击视为轻击、空心重击视为重击</p>
                            </div>
                        </div>

                        <div class="form-group flex items-start">
                            <div class="mr-4 mt-1">
                                <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                                    <img src="res/icon_defense.png" alt="防御姿态图标"
                                        class="w-full h-full object-cover rounded-full">
                                </div>
                            </div>
                            <div class="flex-1">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="defense-stance"
                                        class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                                    <span class="font-medium text-gray-700">防御姿态</span>
                                </label>
                                <p class="text-sm text-gray-500 ml-7 mt-1">所有的空心防御x2视为防御x2</p>
                            </div>
                        </div>

                        <div class="form-group flex items-start">
                            <div class="mr-4 mt-1">
                                <div class="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                                    <img src="res/icon_mobility.png" alt="机动姿态图标"
                                        class="w-full h-full object-cover rounded-full">
                                </div>
                            </div>
                            <div class="flex-1">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="mobile-stance"
                                        class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                                    <span class="font-medium text-gray-700">机动姿态</span>
                                </label>
                                <p class="text-sm text-gray-500 ml-7 mt-1">只有此姿态下才有回避骰子</p>
                            </div>
                        </div>
                        <div class="form-group flex items-start">
                            <div class="mr-4 mt-1">
                                <div class="w-12 h-12 rounded-full bg-yellow-200/10 flex items-center justify-center">
                                    <i class="fa fa-bolt text-yellow-500 text-xl"></i>
                                </div>
                            </div>
                            <div class="flex-1">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" id="electronic-warfare"
                                        class="form-checkbox h-5 w-5 text-yellow-500 rounded border-gray-300 focus:ring-yellow-400">
                                    <span class="font-medium text-gray-700">电子战</span>
                                </label>
                                <p class="text-sm text-gray-500 ml-7 mt-1">选择后取消所有姿态并启用电子战骰子模式</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 骰子数量选择卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow transition-custom hover:shadow-lg">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center">
                        <i class="fa fa-cubes mr-2 text-primary"></i>骰子数量
                    </h2>
                    <div class="space-y-4">
                        <div class="form-group">
                            <label id="label-light" for="light-attack"
                                class="block text-gray-700 font-medium mb-2">轻击骰子</label>
                            <div class="flex items-center">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition-custom"
                                    id="decrease-light">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <input type="number" id="light-attack" min="0" max="10" value="2"
                                    class="w-full py-2 px-4 border-t border-b text-center focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition-custom"
                                    id="increase-light">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="heavy-attack" class="block text-gray-700 font-medium mb-2">重击骰子</label>
                            <div class="flex items-center">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition-custom"
                                    id="decrease-heavy">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <input type="number" id="heavy-attack" min="0" max="10" value="2"
                                    class="w-full py-2 px-4 border-t border-b text-center focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition-custom"
                                    id="increase-heavy">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="defense-dice" class="block text-gray-700 font-medium mb-2">防御骰子</label>
                            <div class="flex items-center">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition-custom"
                                    id="decrease-defense">
                                    <i class="fa fa-minus"></i>
                                </button>
                                <input type="number" id="defense-dice" min="0" max="10" value="2"
                                    class="w-full py-2 px-4 border-t border-b text-center focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition-custom"
                                    id="increase-defense">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="evade-dice" class="block text-gray-700 font-medium mb-2">回避骰子</label>
                            <div class="flex items-center">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition-custom"
                                    id="decrease-evade" disabled>
                                    <i class="fa fa-minus"></i>
                                </button>
                                <input type="number" id="evade-dice" min="0" max="10" value="0"
                                    class="w-full py-2 px-4 border-t border-b text-center focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition-custom"
                                    id="increase-evade" disabled>
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div>

                        <!-- 响应方轻击骰子(电子战专用) -->
                        <div class="form-group hidden" id="responder-dice-group">
                            <label for="responder-dice" class="block text-gray-700 font-medium mb-2">响应方轻击骰子</label>
                            <div class="flex items-center">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-l transition-custom"
                                    id="decrease-responder">−</button>
                                <input type="number" id="responder-dice" min="0" max="10" value="2"
                                    class="w-full py-2 px-4 border-t border-b text-center focus:outline-none focus:ring-2 focus:ring-yellow-400"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-r transition-custom"
                                    id="increase-responder">+</button>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- 计算按钮 -->
                <button id="calculate-btn"
                    class="w-full bg-primary hover:bg-primary/90 text-white font-bold py-4 px-6 rounded-xl transition-custom transform hover:scale-[1.02] shadow-lg hover:shadow-xl flex items-center justify-center space-x-2">
                    <i class="fa fa-calculator text-xl"></i>
                    <span>计算概率</span>
                </button>
            </div>

            <!-- 右侧结果展示面板 -->
            <div class="lg:col-span-2 space-y-6">
                <!-- 结果统计卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow transition-custom hover:shadow-lg">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center">
                        <i class="fa fa-bar-chart mr-2 text-primary"></i>概率统计
                    </h2>
                    <div id="results-container" class="hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-primary">
                                <h3 class="font-bold text-primary mb-2">穿透成功概率</h3>
                                <div class="flex items-end">
                                    <span id="success-rate" class="text-4xl font-bold text-primary">0%</span>
                                    <span class="ml-2 text-gray-500 mb-1">可能性</span>
                                </div>
                            </div>

                            <div class="bg-red-50 rounded-lg p-4 border-l-4 border-danger">
                                <h3 class="font-bold text-danger mb-2">穿透失败概率</h3>
                                <div class="flex items-end">
                                    <span id="fail-rate" class="text-4xl font-bold text-danger">0%</span>
                                    <span class="ml-2 text-gray-500 mb-1">可能性</span>
                                </div>
                            </div>
                        </div>

                        <!-- 概率图表 -->
                        <div class="mb-6">
                            <h3 class="font-bold text-gray-700 mb-3">穿透概率分布</h3>
                            <div id="probability-chart" class="w-full h-64 bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-center h-full text-gray-400">
                                    <i class="fa fa-spinner fa-spin mr-2"></i>
                                    <span>正在生成图表...</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="initial-message" class="text-center py-12 text-gray-500">
                        <i class="fa fa-dice text-4xl mb-4 text-gray-300"></i>
                        <p class="text-lg">请选择姿态和骰子数量，然后点击"计算概率"按钮</p>
                    </div>

                    <div id="loading-indicator" class="hidden text-center py-12 text-gray-500">
                        <i class="fa fa-spinner fa-spin text-4xl mb-4 text-primary"></i>
                        <p class="text-lg">正在计算概率，请稍候...</p>
                    </div>
                </div>

                <!-- 词条选择卡片 -->
                <div class="bg-white rounded-xl p-6 card-shadow transition-custom hover:shadow-lg mt-6">
                    <h2 class="text-xl font-bold text-dark mb-4 flex items-center justify-between cursor-pointer"
                        id="entries-header">
                        <span class="flex items-center">
                            <i class="fa fa-list-ul mr-2 text-primary"></i>词条选择
                        </span>
                        <i class="fa fa-chevron-down text-gray-500 transition-transform duration-300"
                            id="entries-arrow"></i>
                    </h2>

                    <!-- 可折叠内容 -->
                    <div id="entries-content" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4 hidden">
                        <!-- 穿甲（数值型） -->
                        <div class="bg-gray-50 rounded-lg p-4 flex flex-col">
                            <label class="text-gray-700 font-medium mb-2">
                                穿甲
                                <p class="text-sm text-gray-400 mt-2">遭受本攻击时，受击方减少x枚白骰</p>
                            </label>
                            <div class="flex items-center justify-center space-x-1">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold h-8 w-8 flex items-center justify-center rounded"
                                    id="decrease-piercing">−</button>
                                <input type="number" id="piercing" min="0" max="10" value="0"
                                    class="w-12 h-8 py-1 px-2 border text-center text-sm rounded focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold h-8 w-8 flex items-center justify-center rounded"
                                    id="increase-piercing">+</button>
                            </div>
                        </div>

                        <!-- 脆弱（数值型） -->
                        <div class="bg-gray-50 rounded-lg p-4 flex flex-col">
                            <label class="text-gray-700 font-medium mb-2">脆弱
                                <p class="text-sm text-gray-400 mt-2">单位受击时，-1白骰，效果可以叠加</p>

                            </label>
                            <div class="flex items-center justify-center space-x-1">
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold h-8 w-8 flex items-center justify-center rounded"
                                    id="decrease-fragile">−</button>
                                <input type="number" id="fragile" min="0" max="10" value="0"
                                    class="w-12 h-8 py-1 px-2 border text-center text-sm rounded focus:outline-none focus:ring-2 focus:ring-primary/50"
                                    disabled>
                                <button
                                    class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold h-8 w-8 flex items-center justify-center rounded"
                                    id="increase-fragile">+</button>
                            </div>
                        </div>

                        <!-- 低特征 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">低特征</span>
                            <p class="text-sm text-gray-400 mt-1">遭受射击时眼睛可视为闪避</p>
                            <input type="checkbox" id="low-profile"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                        </label>

                        <!-- Kc装甲 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">Kc装甲</span>
                            <p class="text-sm text-gray-400 mt-2">可将闪电视为防御</p>
                            <input type="checkbox" id="kc-armor"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                        </label>

                        <!-- 频闪武器 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">频闪武器</span>
                            <p class="text-sm text-gray-400 mt-2">可将闪电视为重击</p>
                            <input type="checkbox" id="strobe-weapon"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                        </label>

                        <!-- 离子武器 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between cursor-pointer hover:bg-gray-100 transition">
                            <div class="flex items-center justify-between">
                                <span class="font-medium text-gray-700">离子武器</span>
                                <p class="text-sm text-gray-400 mt-2">命中有脆弱标记的目标时，闪电可视为重击</p>
                                <input type="checkbox" id="ion-weapon"
                                    class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary"
                                    disabled>
                            </div>
                        </label>

                        <!-- 峡湾-追击 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">峡湾-追击</span>
                            <p class="text-sm text-gray-400 mt-2">攻击有脆弱标记的目标时，眼睛视为重击</p>
                            <input type="checkbox" id="sealock-chase"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary"
                                disabled>
                        </label>

                        <!-- 薮猫-协同观测 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">薮猫-协同观测</span>
                            <p class="text-sm text-gray-400 mt-2">友军在射击本机可见的目标时，可以重投攻击骰中的眼睛</p>
                            <input type="checkbox" id="caracal-observe"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                        </label>

                        <!-- 白矮星 -->
                        <label
                            class="bg-gray-50 rounded-lg p-4 flex items-center justify-between cursor-pointer hover:bg-gray-100 transition">
                            <span class="font-medium text-gray-700">白矮星-推进器</span>
                            <p class="text-sm text-gray-400 mt-2">本部件的浮游单元有弹药标记时，本机蓝骰的闪电视为闪避</p>
                            <input type="checkbox" id="white-dwarf"
                                class="form-checkbox h-5 w-5 text-primary rounded border-gray-300 focus:ring-primary">
                        </label>

                    </div>
                </div>
            </div>
        </main>

    </div>

    <script>
        // 姿态控制
        const attackStance = document.getElementById('attack-stance');
        const defenseStance = document.getElementById('defense-stance');
        const mobileStance = document.getElementById('mobile-stance');

        // 骰子数量控制
        const lightAttack = document.getElementById('light-attack');
        const heavyAttack = document.getElementById('heavy-attack');
        const defenseDice = document.getElementById('defense-dice');
        const evadeDice = document.getElementById('evade-dice');

        // 加减按钮
        const decreaseLight = document.getElementById('decrease-light');
        const increaseLight = document.getElementById('increase-light');
        const decreaseHeavy = document.getElementById('decrease-heavy');
        const increaseHeavy = document.getElementById('increase-heavy');
        const decreaseDefense = document.getElementById('decrease-defense');
        const increaseDefense = document.getElementById('increase-defense');
        const decreaseEvade = document.getElementById('decrease-evade');
        const increaseEvade = document.getElementById('increase-evade');
        const decreaseResponder = document.getElementById('decrease-responder');
        const increaseResponder = document.getElementById('increase-responder');

        // 计算按钮和结果区域
        const calculateBtn = document.getElementById('calculate-btn');
        const resultsContainer = document.getElementById('results-container');
        const initialMessage = document.getElementById('initial-message');
        const loadingIndicator = document.getElementById('loading-indicator');
        const successRate = document.getElementById('success-rate');
        const failRate = document.getElementById('fail-rate');
        const probabilityChart = document.getElementById('probability-chart');
        const responderGroup = document.getElementById('responder-dice-group');
        const labelLight = document.getElementById('label-light');

        //各种词条
        // 穿甲数量
        const piercing = document.getElementById('piercing');
        const decreasePiercing = document.getElementById('decrease-piercing');
        const increasePiercing = document.getElementById('increase-piercing');
        // 脆弱数量
        const fragile = document.getElementById('fragile');
        const decreaseFragile = document.getElementById('decrease-fragile');
        const increaseFragile = document.getElementById('increase-fragile');
        // 离子武器
        const ionWeapon = document.getElementById('ion-weapon');
        const lowProfile = document.getElementById('low-profile');
        const kcArmor = document.getElementById('kc-armor');
        const strobeWeapon = document.getElementById('strobe-weapon');
        // 峡湾-追击
        const sealockChase = document.getElementById('sealock-chase');
        // 薮猫-协同观测
        const caracalObserve = document.getElementById('caracal-observe');
        // 薮猫-协同观测
        const whiteDwarf = document.getElementById('white-dwarf');

        // 词条卡片折叠逻辑
        const entriesHeader = document.getElementById('entries-header');
        const entriesContent = document.getElementById('entries-content');
        const entriesArrow = document.getElementById('entries-arrow');

        //电子战
        const electronicWarfare = document.getElementById('electronic-warfare');
        const responderDice = document.getElementById('responder-dice');


        entriesHeader.addEventListener('click', () => {
            entriesContent.classList.toggle('hidden');
            entriesArrow.classList.toggle('rotate-180');
        });


        // 姿态互斥逻辑
        defenseStance.addEventListener('change', function () {
            if (this.checked) {
                mobileStance.checked = false;
                updateEvadeDiceControls();
            }
        });

        mobileStance.addEventListener('change', function () {
            if (this.checked) {
                defenseStance.checked = false;
                updateEvadeDiceControls();
            } else {
                evadeDice.value = 0;
                updateEvadeDiceControls();
            }
        });

        


        // 更新回避骰子控件状态
        function updateEvadeDiceControls() {
            if (mobileStance.checked) {
                evadeDice.disabled = false;
                decreaseEvade.disabled = false;
                increaseEvade.disabled = false;
            } else {
                evadeDice.disabled = true;
                decreaseEvade.disabled = true;
                increaseEvade.disabled = true;
                evadeDice.value = 0;
            }
        }

        // 骰子数量控制逻辑
        decreaseLight.addEventListener('click', () => {
            if (parseInt(lightAttack.value) > 0) {
                lightAttack.value = parseInt(lightAttack.value) - 1;
            }
        });

        increaseLight.addEventListener('click', () => {
            if (parseInt(lightAttack.value) < 20) {
                lightAttack.value = parseInt(lightAttack.value) + 1;
            }
        });

        decreaseHeavy.addEventListener('click', () => {
            if (parseInt(heavyAttack.value) > 0) {
                heavyAttack.value = parseInt(heavyAttack.value) - 1;
            }
        });

        increaseHeavy.addEventListener('click', () => {
            if (parseInt(heavyAttack.value) < 20) {
                heavyAttack.value = parseInt(heavyAttack.value) + 1;
            }
        });

        decreaseDefense.addEventListener('click', () => {
            if (parseInt(defenseDice.value) > 0) {
                defenseDice.value = parseInt(defenseDice.value) - 1;
            }
        });

        increaseDefense.addEventListener('click', () => {
            if (parseInt(defenseDice.value) < 20) {
                defenseDice.value = parseInt(defenseDice.value) + 1;
            }
        });

        decreaseEvade.addEventListener('click', () => {
            if (parseInt(evadeDice.value) > 0) {
                evadeDice.value = parseInt(evadeDice.value) - 1;
            }
        });

        increaseEvade.addEventListener('click', () => {
            if (parseInt(evadeDice.value) < 20) {
                evadeDice.value = parseInt(evadeDice.value) + 1;
            }
        });

        decreaseResponder.addEventListener('click', () => {
            if (parseInt(responderDice.value) > 0) responderDice.value = parseInt(responderDice.value) - 1;
        });
        increaseResponder.addEventListener('click', () => {
            if (parseInt(responderDice.value) < 20) responderDice.value = parseInt(responderDice.value) + 1;
        });

        // ------------------- 电子战逻辑 -------------------
        electronicWarfare.addEventListener('change', function () {
            const diceGroups = [
                document.getElementById('heavy-attack').parentElement.parentElement, // 重击
                document.getElementById('defense-dice').parentElement.parentElement, // 防御
                document.getElementById('evade-dice').parentElement.parentElement      // 回避
            ];

            const allEntries = [
                piercing, fragile, ionWeapon, lowProfile, kcArmor, strobeWeapon,
                sealockChase, caracalObserve, whiteDwarf
            ];

            if (this.checked) {


                // 禁用回避骰子
                evadeDice.value = 0;
                updateEvadeDiceControls();

                // 显示电子战骰子模式
                labelLight.textContent = "发起方轻击骰子";
                responderGroup.classList.remove('hidden');
                lightAttack.disabled = false;
                responderDice.disabled = false;

                // 隐藏其他骰子组
                diceGroups.forEach(group => group.classList.add('hidden'));

                // 禁用所有词条
                allEntries.forEach(entry => {
                    if (entry.type === 'checkbox') entry.checked = false;
                    else entry.value = 0;
                    entry.disabled = true;
                });
            } else {
                // 恢复普通骰子
                labelLight.textContent = "轻击骰子";
                responderGroup.classList.add('hidden');
                lightAttack.disabled = false;
                responderDice.disabled = true;

                diceGroups.forEach(group => group.classList.remove('hidden'));

                // 恢复词条可用
                allEntries.forEach(entry => entry.disabled = false);

                // 恢复回避骰子控件
                updateEvadeDiceControls();
            }
        });





        // 计算按钮点击事件
        calculateBtn.addEventListener('click', function () {
            // 显示加载状态
            initialMessage.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            loadingIndicator.classList.remove('hidden');

            // 模拟计算延迟，实际应用中可以移除
            setTimeout(() => {
                if (electronicWarfare.checked) {
                    calculateElectronicWarfare();
                } else {
                    calculateProbabilities();

                }
            }, 800);
        });

        function calculateElectronicWarfare() {
            const attackerDiceCount = parseInt(lightAttack.value);
            const responderDiceCount = parseInt(responderDice.value);

            const totalSimulations = 10000;
            let successCount = 0;
            const penetrationFrequency = {}; // 添加频率统计

            for (let i = 0; i < totalSimulations; i++) {
                const attackerResult = rollattackDice(attackerDiceCount, lightDiceFaces, {
                    isAttackStance: attackStance.checked,
                    isStrobeWeapon: false,
                    isIonWeapon: false,
                    isFragile: false,
                    issealockChase: false,
                    isCaracalObserve: false
                });

                const responderResult = rollattackDice(responderDiceCount, lightDiceFaces, {
                    isAttackStance: attackStance.checked,
                    isStrobeWeapon: false,
                    isIonWeapon: false,
                    isFragile: false,
                    issealockChase: false,
                    isCaracalObserve: false
                });

                const attackerLightning = attackerResult.hDamage;
                const responderLightning = responderResult.hDamage;
                const attackerLight = attackerResult.qDamage;
                const responderLight = responderResult.qDamage;

                let penetration = 0;
                if (attackerLightning > responderLightning) penetration = 1;
                else if (attackerLightning < responderLightning) penetration = 0;
                else {
                    if (attackerLight > responderLight) penetration = 1;
                    else if (attackerLight < responderLight) penetration = 0;
                    else penetration = 1;
                }

                successCount += penetration;
                penetrationFrequency[penetration] = (penetrationFrequency[penetration] || 0) + 1;
            }

            const successPercentage = Math.round((successCount / totalSimulations) * 100);
            const failPercentage = 100 - successPercentage;

            successRate.textContent = `${successPercentage}%`;
            failRate.textContent = `${failPercentage}%`;

            // 关键：生成图表
            generateChart(penetrationFrequency, successPercentage, failPercentage);

            loadingIndicator.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
        }



        // 骰子面定义
        const lightDiceFaces = [
            { type: 'light', value: 2 }, // 轻击x2
            { type: 'light', value: 2 }, // 轻击x2
            { type: 'light', value: 1 }, // 轻击
            { type: 'light', value: 1 }, // 轻击
            { type: 'hollow-light', value: 1 }, // 空心轻击
            { type: 'lightning', value: 'lightning' }, // 闪电
            { type: 'eye', value: 'eye' }, // 眼睛
            { type: 'blank', value: 'blank' } // 空白
        ];

        const heavyDiceFaces = [
            { type: 'heavy', value: 1 }, // 重击
            { type: 'heavy', value: 1 }, // 重击
            { type: 'heavy', value: 1 }, // 重击
            { type: 'heavy', value: 1 }, // 重击
            { type: 'hollow-heavy', value: 1 }, // 空心重击
            { type: 'hollow-light', value: 1 }, // 空心轻击
            { type: 'lightning', value: 'lightning' }, // 闪电
            { type: 'eye', value: 'eye' } // 眼睛
        ];

        const defenseDiceFaces = [
            { type: 'defense', value: 1 }, // 防御
            { type: 'hollow-defense2', value: 0 }, // 空心防御x2
            { type: 'hollow-defense2', value: 0 }, // 空心防御x2
            { type: 'evade', value: 1 }, // 闪避
            { type: 'lightning', value: 'lightning' }, // 闪电
            { type: 'lightning', value: 'lightning' }, // 闪电
            { type: 'eye', value: 'eye' }, // 眼睛
            { type: 'blank', value: 'blank' } // 空白
        ];

        const evadeDiceFaces = [
            { type: 'evade', value: 1 }, // 闪避
            { type: 'evade', value: 1 }, // 闪避
            { type: 'eye', value: 'eye' }, // 眼睛
            { type: 'eye', value: 'eye' }, // 眼睛
            { type: 'lightning', value: 'lightning' }, // 闪电
            { type: 'blank', value: 'blank' }, // 空白
            { type: 'blank', value: 'blank' }, // 空白
            { type: 'blank', value: 'blank' } // 空白
        ];
        // 蒙特卡洛模拟次数
        const totalSimulations = 10000;

        // ------------------- 模拟攻击骰子 -------------------
        function rollattackDice(count, faces, options) {
            const { isAttackStance, isStrobeWeapon, isIonWeapon, isFragile, issealockChase, isCaracalObserve } = options;
            let qDamage = 0, hDamage = 0, eyeCount = 0;

            for (let i = 0; i < count; i++) {
                const face = faces[Math.floor(Math.random() * faces.length)];

                switch (face.type) {
                    case 'light':
                    case 'heavy':
                        // 根据骰子自身类型增加伤害
                        if (face.type === 'light') qDamage += face.value;
                        else hDamage += face.value;
                        break;

                    case 'hollow-light':
                        if (isAttackStance) qDamage += face.value;
                        break;

                    case 'hollow-heavy':
                        if (isAttackStance) hDamage += face.value;
                        break;

                    case 'lightning':
                        if (isStrobeWeapon) hDamage += 1;
                        else if (isIonWeapon && isFragile) qDamage += 1;
                        break;

                    case 'eye':
                        if (issealockChase) hDamage += 1; else if (isCaracalObserve) eyeCount++;// 薮猫-协同观测,记录眼睛数量
                        break;

                    default:
                        break;
                }
            }

            return { qDamage, hDamage, eyeCount };
        }

        // ------------------- 模拟防御或回避骰子 -------------------
        function rollDefenseOrEvadeDice(count, faces, options) {
            const { isDefenseStance, isLowProfile, isKcArmor, isWhiteDwarf } = options;
            let defense = 0, evade = 0;

            for (let i = 0; i < count; i++) {
                const face = faces[Math.floor(Math.random() * faces.length)];

                switch (face.type) {
                    case 'defense':
                        defense += face.value;
                        break;
                    case 'hollow-defense2':
                        defense += isDefenseStance ? 2 : 0;
                        break;
                    case 'evade':
                        evade += face.value;
                        break;
                    case 'lightning':
                        {
                            if (isKcArmor) defense += 1;
                            if (isWhiteDwarf && faces[0].type == "evade") {//白矮星被动且为闪避骰，闪电视为闪避
                                evade += 1;
                            }
                            break;
                        }
                    case 'eye':
                        if (isLowProfile) evade += 1;
                        break;
                    default:
                        break;
                }
            }

            return { defense, evade };
        }


        // ------------------- 计算概率函数 -------------------
        function calculateProbabilities() {
            const options = {
                isAttackStance: attackStance.checked,
                isDefenseStance: defenseStance.checked,
                isMobileStance: mobileStance.checked,
                isIonWeapon: ionWeapon.checked,
                isLowProfile: lowProfile.checked,
                isKcArmor: kcArmor.checked,
                isStrobeWeapon: strobeWeapon.checked,
                issealockChase: sealockChase.checked,
                isCaracalObserve: caracalObserve.checked,
                isFragile: parseInt(fragile.value) > 0,
                isWhiteDwarf: whiteDwarf.checked
            };

            const lightCount = parseInt(lightAttack.value);
            const heavyCount = parseInt(heavyAttack.value);
            const defenseCount = parseInt(defenseDice.value) - parseInt(fragile.value) - parseInt(piercing.value);
            const evadeCount = parseInt(evadeDice.value);

            let successCount = 0;
            const penetrationFrequency = {};

            for (let sim = 0; sim < totalSimulations; sim++) {
                let { qDamage: q1, hDamage: h1, eyeCount: lightEyeCount } = rollattackDice(lightCount, lightDiceFaces, options);
                let { qDamage: q2, hDamage: h2, eyeCount: heavyEyeCount } = rollattackDice(heavyCount, heavyDiceFaces, options);
                // 处理薮猫-协同观测效果,重新掷眼睛骰子
                if (options.isCaracalObserve) {
                    if (lightEyeCount > 0) {
                        const { qDamage: q1_re, hDamage: h1_re } = rollattackDice(lightEyeCount, lightDiceFaces, options);
                        q1 += q1_re; h1 += h1_re;
                    }
                    if (heavyEyeCount > 0) {
                        const { qDamage: q2_re, hDamage: h2_re } = rollattackDice(heavyEyeCount, heavyDiceFaces, options);
                        q2 += q2_re; h2 += h2_re;
                    }
                }

                const { defense, evade: dEvade } = rollDefenseOrEvadeDice(defenseCount, defenseDiceFaces, options);
                const { defense: eDefense, evade: eEvade } = rollDefenseOrEvadeDice(evadeCount, evadeDiceFaces, options);

                const totalQ = q1 + q2;
                const totalH = h1 + h2;
                const totalDefense = defense + eDefense;
                const totalEvade = dEvade + eEvade;

                // 判断穿透
                let penetration = 0;
                if (totalH > totalEvade || (totalQ + totalH) > (totalDefense + totalEvade)) penetration = 1;

                successCount += penetration;
                penetrationFrequency[penetration] = (penetrationFrequency[penetration] || 0) + 1;
            }

            const successPercentage = Math.round((successCount / totalSimulations) * 100);
            const failPercentage = 100 - successPercentage;

            successRate.textContent = `${successPercentage}%`;
            failRate.textContent = `${failPercentage}%`;

            generateChart(penetrationFrequency, successPercentage, failPercentage);

            loadingIndicator.classList.add('hidden');
            resultsContainer.classList.remove('hidden');
        }


        // 生成图表函数
        function generateChart(frequencyData, successRate, failRate) {
            // 清空图表区域
            probabilityChart.innerHTML = '';

            // 创建图表容器
            const chartContainer = document.createElement('div');
            chartContainer.className = 'w-full h-full';
            probabilityChart.appendChild(chartContainer);

            // 创建穿透成功和失败的柱状图
            const successBar = document.createElement('div');
            successBar.className = 'w-full mb-2 bg-blue-50 rounded-lg overflow-hidden';

            const successFill = document.createElement('div');
            successFill.className = 'h-10 bg-primary transition-all duration-1000 ease-out';
            successFill.style.width = `${successRate}%`;

            const successLabel = document.createElement('div');
            successLabel.className = 'flex items-center justify-between px-4 py-2 text-white font-bold';
            successLabel.innerHTML = `
                <span>穿透成功</span>
                <span>${successRate}%</span>
            `;

            successFill.appendChild(successLabel);
            successBar.appendChild(successFill);

            const failBar = document.createElement('div');
            failBar.className = 'w-full  mb-2 bg-red-50 rounded-lg overflow-hidden';

            const failFill = document.createElement('div');
            failFill.className = 'h-10 bg-danger transition-all duration-1000 ease-out';
            failFill.style.width = `${failRate}%`;

            const failLabel = document.createElement('div');
            failLabel.className = 'flex items-center justify-between px-4 py-2 text-white font-bold';
            failLabel.innerHTML = `
                <span>穿透失败</span>
                <span>${failRate}%</span>
            `;

            failFill.appendChild(failLabel);
            failBar.appendChild(failFill);

            chartContainer.appendChild(successBar);
            chartContainer.appendChild(failBar);
        }

        // 穿甲数量按钮逻辑
        decreasePiercing.addEventListener('click', () => {
            if (parseInt(piercing.value) > 0) {
                piercing.value = parseInt(piercing.value) - 1;
            }
        });
        increasePiercing.addEventListener('click', () => {
            if (parseInt(piercing.value) < 20) {
                piercing.value = parseInt(piercing.value) + 1;
            }
        });

        // 脆弱数量按钮逻辑
        decreaseFragile.addEventListener('click', () => {
            if (parseInt(fragile.value) > 0) {
                fragile.value = parseInt(fragile.value) - 1;
                updateIonWeaponState();
                updatesealockChaseState();
            }
        });
        increaseFragile.addEventListener('click', () => {
            if (parseInt(fragile.value) < 20) {
                fragile.value = parseInt(fragile.value) + 1;
                updateIonWeaponState();
                updatesealockChaseState()
            }
        });

        // 更新离子武器状态
        function updateIonWeaponState() {
            if (parseInt(fragile.value) > 0) {
                ionWeapon.disabled = false;
            } else {
                ionWeapon.disabled = true;
                ionWeapon.checked = false;
            }
        }

        // 更新锤头鲨状态
        function updatesealockChaseState() {
            if (parseInt(fragile.value) > 0) {
                sealockChase.disabled = false;
            } else {
                sealockChase.disabled = true;
                sealockChase.checked = false;
            }
        }


        // 初始化页面
        updateEvadeDiceControls();
    </script>
</body>

</html>